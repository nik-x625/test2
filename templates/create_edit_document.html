<!-- Document Creation Form -->
<div class="container-fluid">
  <div class="row">
    <!-- Fixed Width Sidebar -->
    <div class="col-auto">
      <div class="document-sidebar">
        <div class="card mt-0">
          <div class="card-body">
            <h4 class="card-title text-light mb-2">Document Structure</h4>
            <div class="document-sidebar-group">
              <div class="document-sidebar-group-label">Documentation</div>
              <ul class="document-sidebar-menu">
                <li class="document-sidebar-menu-item">
                  <button class="document-sidebar-menu-button fw-medium" data-bs-toggle="collapse"
                    data-bs-target="#documentationCollapse" aria-expanded="true" aria-controls="documentationCollapse">
                    <i class="bi bi-book"></i>
                    <span>Documentation</span>
                    <i class="bi bi-chevron-down ms-auto document-chevron-toggle document-chevron-down"></i>
                  </button>
                  <div class="collapse show" id="documentationCollapse">
                    <ul class="document-sidebar-submenu">
                      <li class="document-sidebar-submenu-item">
                        <button class="document-sidebar-submenu-button">
                          <i class="bi bi-file-text"></i>
                          <span>1. Introduction</span>
                        </button>
                      </li>
                      <li class="document-sidebar-submenu-item">
                        <button class="document-sidebar-submenu-button">
                          <i class="bi bi-file-text"></i>
                          <span>2. Project Overview</span>
                        </button>
                      </li>
                      <li class="document-sidebar-submenu-item">
                        <button class="document-sidebar-submenu-button">
                          <i class="bi bi-file-text"></i>
                          <span>3. Scope</span>
                        </button>
                      </li>
                      <li class="document-sidebar-submenu-item">
                        <button class="document-sidebar-submenu-button" data-bs-toggle="collapse"
                          data-bs-target="#chaptersCollapse" aria-expanded="true" aria-controls="chaptersCollapse">
                          <i class="bi bi-folder"></i>
                          <span>4. Chapters</span>
                          <i class="bi bi-chevron-down ms-auto document-chevron-toggle document-chevron-down"></i>
                        </button>
                        <div class="collapse show" id="chaptersCollapse">
                          <ul class="document-sidebar-submenu">
                            <li class="document-sidebar-submenu-item">
                              <button class="document-sidebar-submenu-button">
                                <i class="bi bi-file-text"></i>
                                <span>4.1 Chapter 1</span>
                              </button>
                            </li>
                            <li class="document-sidebar-submenu-item">
                              <button class="document-sidebar-submenu-button">
                                <i class="bi bi-file-text"></i>
                                <span>4.2 Chapter 2</span>
                              </button>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Panel -->
    <div class="col">
      <div class="card mt-0">
        <div class="card-body">
          <h4 class="card-title text-light">{% if doc %}Edit{% else %}New{% endif %} Document Parameters</h4>
          {% if error %}
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
          {% endif %}
          {% if doc %}
            <form hx-post="/edit-doc/{{ doc._id }}" hx-target="#mainContent" novalidate>
          {% else %}
            <form hx-post="/create-document" hx-target="#mainContent" novalidate>
          {% endif %}
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="title" class="form-label text-light">Title</label>
                <input type="text" class="form-control bg-dark text-light" id="title" name="title" 
                       value="{{ doc.title if doc else '' }}" required>
              </div>
            </div>

            <div class="row mb-3">
              <div class="col-md-6">
                <label for="product" class="form-label text-light">Product</label>
                <input type="text" class="form-control bg-dark text-light" id="product" name="product"
                       value="{{ doc.product if doc else '' }}" required>
              </div>
            </div>        
            
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="version" class="form-label text-light">Version</label>
                <input type="text" class="form-control bg-dark text-light" id="version" name="version"
                       value="{{ doc.version if doc else '' }}" required>
              </div>
              <div class="col-md-6">
                <label for="status" class="form-label text-light">Status</label>
                <select class="form-select bg-dark text-light" id="status" name="status" required>
                  <option value="draft" {% if doc and doc.status == 'draft' %}selected{% endif %}>Draft</option>
                  <option value="review" {% if doc and doc.status == 'review' %}selected{% endif %}>Review</option>
                  <option value="published" {% if doc and doc.status == 'published' %}selected{% endif %}>Published</option>
                </select>
              </div>
            </div>
      
            <div class="mb-3">
              <label for="introduction" class="form-label text-light">1. Introduction</label>
              <textarea class="form-control bg-dark text-light" id="introduction" name="introduction" rows="3"
                        required>{{ doc.introduction if doc else '' }}</textarea>
            </div>
      
            <div class="mb-3">
              <label for="project_overview" class="form-label text-light">2. Project Overview</label>
              <textarea class="form-control bg-dark text-light" id="project_overview" name="project_overview" rows="3"
                        required>{{ doc.project_overview if doc else '' }}</textarea>
            </div>
      
            <div class="mb-3">
              <label for="scope" class="form-label text-light">3. Scope</label>
              <textarea class="form-control bg-dark text-light" id="scope" name="scope" rows="3"
                        required>{{ doc.scope if doc else '' }}</textarea>
            </div>
      
            <div class="d-flex justify-content-end gap-2">
              <button type="button" class="btn btn-secondary" hx-get="/docs" hx-target="#mainContent">Cancel</button>
              <button type="submit" class="btn btn-primary">
                {% if doc %}Update{% else %}Create{% endif %} Document
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.document-sidebar {
  width: 280px;
  position: sticky;
  top: 0.5rem;
  max-height: calc(100vh - 1rem);
  overflow-y: auto;
}

.document-sidebar .card {
  height: 100%;
}

.document-sidebar .card-body {
  padding: 0.75rem;
}

/* Custom scrollbar for the document sidebar */
.document-sidebar::-webkit-scrollbar {
  width: 6px;
}

.document-sidebar::-webkit-scrollbar-track {
  background: var(--bs-dark);
}

.document-sidebar::-webkit-scrollbar-thumb {
  background: var(--bs-gray-700);
  border-radius: 3px;
}

.document-sidebar::-webkit-scrollbar-thumb:hover {
  background: var(--bs-gray-600);
}

/* Document Sidebar Tree Structure Styles */
.document-sidebar-group {
  margin-bottom: 0.75rem;
}

.document-sidebar-group-label {
  color: var(--bs-gray-500);
  font-size: 0.75rem;
  text-transform: uppercase;
  padding: 0.25rem 0.75rem;
}

.document-sidebar-menu {
  list-style: none;
  padding: 0;
  margin: 0;
}

.document-sidebar-menu-item {
  margin-bottom: 0.25rem;
}

.document-sidebar-menu-button {
  display: flex;
  align-items: center;
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: transparent;
  border: none;
  color: var(--bs-light);
  text-align: left;
  transition: all 0.2s;
}

.document-sidebar-menu-button:hover {
  background: var(--bs-gray-800);
}

.document-sidebar-submenu {
  list-style: none;
  padding-left: 0.75rem;
  margin: 0;
}

.document-sidebar-submenu-item {
  margin-bottom: 0.25rem;
}

.document-sidebar-submenu-button {
  display: flex;
  align-items: center;
  width: 100%;
  padding: 0.5rem 0.75rem;
  background: transparent;
  border: none;
  color: var(--bs-light);
  text-align: left;
  transition: all 0.2s;
}

.document-sidebar-submenu-button:hover {
  background: var(--bs-gray-800);
}

.document-chevron-toggle {
  transition: transform 0.2s;
}

.document-chevron-toggle.document-chevron-down {
  transform: rotate(0deg);
}

.document-chevron-toggle.document-chevron-up {
  transform: rotate(180deg);
}

.document-sidebar-divider {
  border-color: var(--bs-gray-700);
  margin: 0.75rem 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .document-sidebar {
    width: 100%;
    position: relative;
    top: 0;
    max-height: none;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Handle chevron toggle
  const collapseElements = document.querySelectorAll('[data-bs-toggle="collapse"]');
  collapseElements.forEach(element => {
    element.addEventListener('click', function() {
      const chevron = this.querySelector('.document-chevron-toggle');
      if (chevron) {
        chevron.classList.toggle('document-chevron-down');
        chevron.classList.toggle('document-chevron-up');
      }
    });
  });
});
</script>


